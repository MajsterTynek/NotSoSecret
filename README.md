
# \(Shared,) Not so Secret

Mod that logs encryption keys to a file or uses a preset one.  
Shared Secret is a key generated by client,  
and used both by client and server...  

You can use said key to decrytpt incoming and outgoing  
TCP streams of Minecraft connection for your own use.  

Mod of good choice if you want your proxy  
or sniffer to understand data passing trough.  

## Decryption of a stream

Here's a batch script you can use to automate it:  

    @echo off
    copy %1 %1_decrypted
    snip -f %1 %2 %1_encrypted
    openssl enc -aes-128-cfb8 -d -nopad -K %3 -iv %3 -in %1_encrypted -out %3.tmp
    snip -f %3.tmp 0 %1_decrypted %2
    del %1_encrypted
    del %3.tmp

`snip` is [CopyFileFragm](https://software.muzychenko.net/en/copy-file-fragment/), and `openssl` is [openssl](https://www.openssl.org/)  

Run `decrypt <streamdump.bin> <offset> <key>`  
will generate `streamdump.bin_decrypted`.  
*Do not use it if stream is plaintext!*  

If you are sure encryption is present,  
you need to find proper offset in streams.  
First packet  from server is usually `Encryption Request`.  
For client, skip `Handshake`, `Login Start` and `Encryption Response`.  

Refer to protocol [documentation](https://wiki.vg/Protocol#Login) to know more about it.  

You can get encryption offset from  
inspecting a dump with a hex editor ([HxD](https://mh-nexus.de/en/hxd/)).  
Open it, skip number of bytes encoded  
in LEB128(*varint*) (including size of it).  
If from server, do that three times.  
Current cursor position is the offest.  

**Good luck! Have fun!**
